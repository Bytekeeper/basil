---
layout: page
title: Ranking
---
<script id="tableTemplate" type="text/x-handlebars-template">
	{% raw %}
<table>
	<thead>
	<tr>
		<th>#</th>
		<th>Bot</th>
		<th>ELO</th>
		<th># Games</th>
		<th># Won</th>
		<th># Lost</th>
		<th>% Win</th>
		<th class="tooltip">&Delta; Crashes<span role="tooltip">Crashes since last update. Resetted after the first game after an update.</span></th>
		<th>Last updated</th>
	</tr>
	</thead>
	<tbody>
		{{#each this}}
		{{#if enabled}}
		<tr>
		<th>
		{{inc @index}}
		</th>
		<td name="{{anchorName}}" class="{{racecol race}}">{{botName}}<div class="float-right"><a class="normal" href="bot.html?bot={{botName}}" target="_blank"><i class="fas fa-chart-line"></i></a></div></td>
		<td>{{#if rating}}{{rating}}{{else}}<small class="tiny">pending</small>{{/if}}</td>
		<td>{{played}}</td>
		<td>{{won}}</td>
		<td>{{lost}}</td>
		<td>{{winRate}}</td>
		<td>{{crashesSinceUpdate}}</td>
		<td>{{lastUpdated}}</td>
		</tr>
		{{/if}}
		{{/each}}
	</tbody>
</table>
<h3>Disabled bots</h3>
<table>
	<thead>
	<tr>
		<th>#</th>
		<th>Bot</th>
		<th>ELO</th>
		<th># Games</th>
		<th># Won</th>
		<th># Lost</th>
		<th>% Win</th>
		<th># Crashes</th>
		<th data-sorter="false">Reason</th>
	</tr>
	</thead>
	<tbody>
		{{#each this}}
		{{#if showDisabled}}
		<tr>
		<th>
		{{inc @index}}
		</th>
		<td name="{{anchorName}}" class="{{racecol race}}">{{botName}}<div class="float-right"><a class="normal" href="bot.html?bot={{botName}}" target="_blank"><i class="fas fa-chart-line"></i></a></div></td>
		<td>{{#if rating}}{{rating}}{{else}}<small class="tiny">n/a</small>{{/if}}</td>
		<td>{{played}}</td>
		<td>{{won}}</td>
		<td>{{lost}}</td>
		<td>{{winRate}}</td>
		<td>{{crashed}}</td>
		<td><small>{{disabledReason}}</small></td>
		</tr>
		{{/if}}
		{{/each}}
	</tbody>
</table>

		{% endraw %}
</script>
<script>
	$(function() {
		let source = $("#tableTemplate").html();
		let template = Handlebars.compile(source);
		let numberFormat = new Intl.NumberFormat(undefined, { style: "percent", minimumFractionDigits: 2}).format;
		$.getJSON("http://basilicum.bytekeeper.org/stats/ranking.json", function(data) {
			for (i = 0; i < data.length; i++) {
				let played = data[i].won + data[i].lost;
				if (played > 0 && typeof data[i].won !== "undefined") {
					data[i].winRate = numberFormat(data[i].won / played);
				} else {
					data[i].winRate = "-";
				}
				if (played < 30) data[i].rating = null;
				if (data[i].lastUpdated) data[i].lastUpdated = basil.formatDate(data[i].lastUpdated);
				data[i].anchorName = encodeURIComponent(data[i].botName);
				data[i].showDisabled = !data[i].enabled && (data[i].won > 0 || data[i].lost > 0);
				data[i].disabledReason = data[i].disabledReason || "Disabled on SSCAIT/locally";
			}
			// Required for index to work as expected
			data.sort(function(a,b) { 
				if (a.enabled != b.enabled) {
					if (a.enabled) return -1; else return 1;
				}
				let aPlayed = a.won + a.lost;
				let bPlayed = b.won + b.lost;
				if (aPlayed < 30 && bPlayed >= 30) return 1;
				if (bPlayed < 30 && aPlayed >= 30) return -1;
				if (a.rating !== b.rating) return b.rating - a.rating; 
				if (a.winRate !== b.winRate) return b.winRate - a.winRate;
				return b.won - a.won;
			});
			let html = template(data);
			$("#eloTable").append(html);
			$("#eloTable table").tablesorter();
			if (location.hash) {
				let headerHeight = $("thead tr").height();
				let dest = $("td[name='" + location.hash.substring(1) + "']");
				$("html, body").animate({ scrollTop: dest.offset().top - headerHeight }, 'slow');
			}
		});
	});
</script>
<small>
	The following table is sorted by ELO, % Win, # Won by default. To sort multiple columns simulatenously, hold <em>shift</em> when clicking a second, third... column.
</small>
<div id="eloTable">
</div>
<small>Source: <a href="http://basilicum.bytekeeper.org/stats/ranking.json">http://basilicum.bytekeeper.org/stats/ranking.json</a></small>
</table>
