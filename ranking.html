---
layout: page
title: Ranking
---
<script id="tableTemplate" type="text/x-handlebars-template">
	{% raw %}
		{{#each this}}
		<tr {{#unless enabled}}class="disabled"{{/unless}}>
		<th>
		{{inc @index}}
		</th>
		<td name="{{anchorName}}" class="{{racecol race}}">{{botName}}<div class="float-right"><a class="normal" href="elo.html?bot={{botName}}" target="_blank"><i class="fas fa-chart-line"></i></a></div></td>
		<td>{{#if rating}}{{rating}}{{else}}<small class="tiny">pending</small>{{/if}}</td>
		<td>{{played}}</td>
		<td>{{won}}</td>
		<td>{{lost}}</td>
		<td>{{winRate}}</td>
		<td>{{crashed}}</td>
		<td>{{#if enabled}}{{lastUpdated}}{{else}}Disabled:<br><small class="tiny">{{disabledReason}}</small>{{/if}}</td>
		</tr>
		{{/each }}
		{% endraw %}
</script>
<script>
	$(function() {
		Handlebars.registerHelper("inc", function(v) { return parseInt(v) + 1; });

		Handlebars.registerHelper("racecol", function(v) { 
			switch (v) {
				case "PROTOSS":
					return "race_protoss";
				case "ZERG":
					return "race_zerg";
				case "TERRAN":
					return "race_terran";
				case "RANDOM":
					return "race_random";
				default:
					return "race_unknown";
			}
			return parseInt(v) + 1; 
		});
		let source = $("#tableTemplate").html();
		let template = Handlebars.compile(source);
		let numberFormat = new Intl.NumberFormat(undefined, { style: "percent", minimumFractionDigits: 2}).format;
		$.getJSON("http://basilicum.bytekeeper.org/stats/ranking.json", function(data) {
			for (i = 0; i < data.length; i++) {
				let played = data[i].won + data[i].lost;
				if (played > 0 && typeof data[i].won !== "undefined") {
					data[i].winRate = numberFormat(data[i].won / played);
				} else {
					data[i].winRate = "-";
				}
				if (played < 30) data[i].rating = null;
				if (data[i].lastUpdated) data[i].lastUpdated = moment.unix(data[i].lastUpdated).format("YYYY.MM.DD hh:mm:ss a");
				data[i].anchorName = encodeURIComponent(data[i].botName);
			}
			// Required for index to work as expected
			data.sort(function(a,b) { 
				if (a.enabled != b.enabled) {
					if (a.enabled) return -1; else return 1;
				}
				let aPlayed = a.won + a.lost;
				let bPlayed = b.won + b.lost;
				if (aPlayed < 30 && bPlayed >= 30) return 1;
				if (bPlayed < 30 && aPlayed >= 30) return -1;
				if (a.rating !== b.rating) return b.rating - a.rating; 
				if (a.winRate !== b.winRate) return b.winRate - a.winRate;
				return b.won - a.won;
			});
			let html = template(data);
			$("#eloTable tbody").append(html);
			$("#eloTable").tablesorter();
			if (location.hash) {
				let headerHeight = $("thead tr").height();
				let dest = $("td[name='" + location.hash.substring(1) + "']");
				$("html, body").animate({ scrollTop: dest.offset().top - headerHeight }, 'slow');
			}
		});
	});
</script>
<small>
The following table is sorted by ELO, % Win, # Won by default. To sort multiple columns simulatenously, hold <em>shift</em> when clicking a second, third... column.
</small>
<table id="eloTable">
	<thead>
	<tr>
		<th>#</th>
		<th>Bot</th>
		<th>ELO</th>
		<th># Games</th>
		<th># Won</th>
		<th># Lost</th>
		<th>% Win</th>
		<th># Crashes</th>
		<th>Last updated</th>
	</tr>
	</thead>
	<tbody>
	</tbody>
</table>
<small>Source: <a href="http://basilicum.bytekeeper.org/stats/ranking.json">http://basilicum.bytekeeper.org/stats/ranking.json</a></small>
</table>
