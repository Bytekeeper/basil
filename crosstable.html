---
layout: page
title: Crosstable
---
<script id="crosstable" type="text/x-handlebars-template">
	{% raw %}
<table class="tiny crosstable">
<thead>
	<tr>
		<th style="max-width: 116px; min-width: 116px;">Bot</th>
		{{#each bots}}
		<th class="{{racecol race}}">{{ name }}</th>
		{{/each}}
	</tr>
</thead>
<tbody>
	{{#each bots as |botA|}}
	<tr class="highlight">
		<th class="{{racecol race}}">{{ name }}</th>
		{{#each @root.bots as |botB|}}
		{{#with (lookup (lookup @root.stats botA.name) botB.name)}}
		{{#unless self}}
		<td style="background-color: rgba({{color}});">
		{{won}} - {{lost}}
		</td>
		{{else}}
		<td> </td>
		{{/unless}}
		{{/with}}
		{{/each}}
	</tr>
	{{/each}}
</tbody>
</table>
{% endraw %}
</script>
<script>
	$(function() {
		Handlebars.registerHelper("racecol", function(v) { 
			switch (v) {
				case "PROTOSS":
					return "race_protoss";
				case "ZERG":
					return "race_zerg";
				case "TERRAN":
					return "race_terran";
				case "RANDOM":
					return "race_random";
				default:
					return "race_unknown";
			}
			return parseInt(v) + 1; 
		});
		let source = $("#crosstable").html();
		let template = Handlebars.compile(source);
		$.getJSON("http://basilicum.bytekeeper.org/stats/botVsBot.json", function(recv) {
			let stats = {};
			function entry(a, b) {
				if (!stats[a]) stats[a] = {};
				if (!stats[a][b]) stats[a][b] = {won: 0, lost: 0};
				return stats[a][b];
			}
			for (i = 0; i < recv.botVsBotStat.length; i++) {
				let bvb = recv.botVsBotStat[i];
				entry(bvb.winner, bvb.loser).won = bvb.won;
				entry(bvb.loser, bvb.winner).lost= bvb.won;
			}
			for (i = 0; i < recv.botinfos.length; i++) {
				let botI = recv.botinfos[i].name;
				for (j = 0; j < recv.botinfos.length; j++) {
					let botJ =  recv.botinfos[j].name;
					let e = entry(botI, botJ);
					if (i != j) {
						let w = e.won + 1;
						let l = e.lost + 1;
						let red = l / w;
						red = Math.min(1, red * red);
						let green = w / l;
						green = Math.min(1, green * green);
						let blue = Math.min(green, red);
						e.color = Math.ceil(255 * red) + "," + Math.ceil(255 * green) + "," + Math.ceil(255 * blue) + ",0.8";

					} else e.self = true;
				}
			}

			let table = {bots: recv.botinfos, stats: stats}
			let html = template(table);
			let htmlTable = $("#tablePlaceholder");
			htmlTable.append(html);
			let cells = htmlTable.find("td");
			cells.on("mouseover", function() {
				$(this).closest("table").find("td:nth-child(" + ($(this).index() + 1) + ")").addClass("highlight");
			});
			cells.on("mouseout", function() {
				$(this).closest("table").find("td:nth-child(" + ($(this).index() + 1) + ")").removeClass("highlight");
			});
		});
	});
</script>
<div>Download: <a href="http://basilicum.bytekeeper.org/stats/botVsBot.csv">botVsBot.csv</a></div>
<div id="tablePlaceholder" style="position: absolute; left: 0;">
</div>
