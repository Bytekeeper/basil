---
layout: page
title: Crosstable
---
<script id="crosstable" type="text/x-handlebars-template">
	{% raw %}
<table class="tiny">
<thead>
	<tr>
		<th style="max-width: 116px; min-width: 116px;">Bot</th>
		{{#each bots}}
		<th class="{{racecol race}}">{{ name }}</th>
		{{/each}}
	</tr>
</thead>
<tbody>
	{{#each bots as |botA|}}
	<tr class="highlight">
		<th class="{{racecol race}}">{{ name }}</th>
		{{#each @root.bots as |botB|}}
		<td>
		{{#with (lookup (lookup @root.stats botA.name) botB.name)}}
		{{#unless self}}{{won}} - {{lost}}{{/unless}}
		{{else}}
		{{#unless self}}0 - 0{{/unless}}
		{{/with}}
		</td>
		{{/each}}
	</tr>
	{{/each}}
</tbody>
</table>
{% endraw %}
</script>
<script>
	$(function() {
		Handlebars.registerHelper("racecol", function(v) { 
			switch (v) {
				case "PROTOSS":
					return "race_protoss";
				case "ZERG":
					return "race_zerg";
				case "TERRAN":
					return "race_terran";
				case "RANDOM":
					return "race_random";
				default:
					return "race_unknown";
			}
			return parseInt(v) + 1; 
		});
		let source = $("#crosstable").html();
		let template = Handlebars.compile(source);
		$.getJSON("http://basilicum.bytekeeper.org/stats/botVsBot.json", function(recv) {
			let stats = {};
			function entry(a, b) {
				if (!stats[a]) stats[a] = {};
				if (!stats[a][b]) stats[a][b] = {won: 0, lost: 0};
				return stats[a][b];
			}
			for (i = 0; i < recv.botVsBotStat.length; i++) {
				let bvb = recv.botVsBotStat[i];
				entry(bvb.winner, bvb.loser).won = bvb.won;
				entry(bvb.loser, bvb.winner).lost= bvb.won;
			}
			for (i = 0; i < recv.botinfos.length; i++) {
				let bot = recv.botinfos[i].name;
				entry(bot, bot).self = true;
			}
			let table = {bots: recv.botinfos, stats: stats}
			let html = template(table);
			let htmlTable = $("#tablePlaceholder");
			htmlTable.append(html);
			let cells = htmlTable.find("td");
			cells.on("mouseover", function() {
				$(this).closest("table").find("td:nth-child(" + ($(this).index() + 1) + ")").addClass("highlight");
			});
			cells.on("mouseout", function() {
				$(this).closest("table").find("td:nth-child(" + ($(this).index() + 1) + ")").removeClass("highlight");
			});
		});
	});
</script>
<div id="tablePlaceholder">
</div>
