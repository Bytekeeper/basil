---
layout: page
title: Stats
---
<script id="rowTemplate" type="text/x-handlebars-template">
	{% raw %}
		<tr>
		<th>Games played</th>
		<td>{{gamesPlayed}}</td>
		</tr>
		<tr>
		<th class="race_terran">Terran bots</th>
		<td>{{terranBots}}</td>
		</tr>
		<tr>
		<th class="race_protoss">Protoss bots</th>
		<td>{{protossBots}}</td>
		</tr>
		<tr>
		<th class="race_zerg">Zerg bots</th>
		<td>{{zergBots}}</td>
		</tr>
		<tr>
		<th class="race_random">Random bots</th>
		<td>{{randomBots}}</td>
		</tr>
		<tr>
		<th>Crashes</th>
		<td>{{crashes}}</td>
		</tr>
		<tr>
		<th>Avg. playtime (realtime)</th>
		<td>{{time averageGameRealtime}} seconds</td>
		</tr>
		<tr>
		<th>Next bot update</th>
		<td>{{nextUpdateTime}}</td>
		</tr>
		<tr>
		{% endraw %}
</script>
<script id="raceCrossTableTemplate" type="text/x-handlebars-template">
	{% raw %}
	<thead>
	<th>Race</th>
	<th>Won</th>
	<th>Lost</th>
	<th>% Win</th>
	{{#each this}}
	<th class="cap race_{{@key}}">{{@key}}</th>
	{{/each}}
	</thead>
	<tbody>
	{{#each this as |vsrow race|}}
	<tr>
	<th class="cap race_{{race}}">{{race}}</th>
	<td>{{won}}</td>
	<td>{{lost}}</td>
	<td>{{winRate}}</td>
	<td>{{vsrow.terran}}</td>
	<td>{{vsrow.protoss}}</td>
	<td>{{vsrow.zerg}}</td>
	<td>{{vsrow.random}}</td>
	</tr>
	{{/each}}
	</tbody>
	{% endraw %}
</script>
<script type="riot/tag">
<unit-stats-table>
	{% raw %}
<table>
	<thead>
	<th>Unit</th>
	<th>Created</th>
	<th>Destroyed</th>
</thead>
<tbody>
	<tr each={unitStats}>
		<td>{name}</td>
		<td>{created}</td>
		<td>{destroyed}</td>
	</tr>
</tbody>
</table>	
	{% endraw %}
</unit-stats-table>
</script>
<script>
	$(function() {
		let rowTemplateSource = $("#rowTemplate").html();
		let rowTemplate = Handlebars.compile(rowTemplateSource);
		let crossTableTemplateSource = $("#raceCrossTableTemplate").html();
		let crossTableTemplate = Handlebars.compile(crossTableTemplateSource);
		let numberFormat = new Intl.NumberFormat(undefined, { minimumFractionDigits: 2, maximumFractionDigis: 2}).format;
		let percentFormat = new Intl.NumberFormat(undefined, { style: "percent", minimumFractionDigits: 1}).format;
		Handlebars.registerHelper("time", function(v) { return numberFormat(v); });
		let unitStatsTable = riot.mount('*')[0];

		$.getJSON("http://basilicum.bytekeeper.org/stats/stats.json", function(data) {
			data.nextUpdateTime = new Date(data.nextUpdateTime).toLocaleString([], {hour: "numeric"}) + " - " + new Date(data.nextUpdateTime + 60 * 60 * 1000).toLocaleString([], {hour: "numeric"}); 
			let rowsHtml = rowTemplate(data);
			$("#statsTable tbody").append(rowsHtml);
			let crossTableData = data.raceCrossTable;
			for (let key in crossTableData) {
				crossTableData[key].lost = 0;
			}
			for (let key in crossTableData) {
				let row = crossTableData[key];
				row.won = row.terran + row.protoss + row.zerg + row.random;
				for (let e in row) {
					if (typeof crossTableData[e] !== "undefined") crossTableData[e].lost += row[e];
				}
			}
			for (let key in crossTableData) {
				let row = crossTableData[key];
				row.winRate = (row.won + row.lost) > 0 ? percentFormat(row.won / (row.won + row.lost)) : "-";
			}

			let crossTable = crossTableTemplate(crossTableData);
			$("#crossTable").append(crossTable);
			unitStatsTable.update(data);
			$(unitStatsTable.root.childNodes[0]).tablesorter();
		});
	});
</script>
<div class="row">
	<div class="col-2">
		<table id="statsTable">
			<thead>
				<tr>
					<th>Item</th>
					<th>Value</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
	<div class="col-4">
		<table id="crossTable">
		</table>
	</div>
</div>
<h4>Data since ~2019.03.15:</h4>
<div class="row">
	<unit-stats-table>
	</unit-stats-table>
</div>
<small>Source: <a href="http://basilicum.bytekeeper.org/stats/stats.json">http://basilicum.bytekeeper.org/stats/stats.json</a></small>
