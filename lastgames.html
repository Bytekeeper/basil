---
layout: page
title: Last 24h
---
<script id="tableTemplate" type="text/x-handlebars-template">
	{% raw %}
		{{#each this}}
		<tr>
		<td class="{{racecol botARace}}">{{#if botAWon}}<i class="fas fa-trophy"></i> {{/if}}{{#if botBWon}}<i class="fas fa-sad-tear"></i> {{/if}}{{#if botACrashed}}<i class="fas fa-car-crash"></i> {{else}}{{#unless winner}}<i class="fas fa-poo-storm"></i>{{/unless}}{{/if}}{{botA}}</td> 
		<td class="{{racecol botBRace}}">{{#if botBWon}}<i class="fas fa-trophy"></i> {{/if}}{{#if botAWon}}<i class="fas fa-sad-tear"></i> {{/if}}{{#if botBCrashed}}<i class="fas fa-car-crash"></i> {{else}}{{#unless winner}}<i class="fas fa-poo-storm"></i>{{/unless}}{{/if}}{{botB}}</td> 
		<td>{{map}}</td>
		<td>{{time}}</td>
		<td>{{#if winner}}<a href="{{replayUrl}}"><i class="fas fa-download"></i></a>{{/if}}</td>
		<td>{{#if winner}}<a href="http://www.openbw.com/replay-viewer/?rep={{replayUrl}}" target="_blank">OpenBW</a>{{/if}}</td>
		</tr>
		{{/each }}
		{% endraw %}
</script>
<script>
	$(function() {
		Handlebars.registerHelper("inc", function(v) { return parseInt(v) + 1; });
		Handlebars.registerHelper("racecol", function(v) { 
			switch (v) {
				case "PROTOSS":
					return "race_protoss";
				case "ZERG":
					return "race_zerg";
				case "TERRAN":
					return "race_terran";
				case "RANDOM":
					return "race_random";
				default:
					return "race_unknown";
			}
			return parseInt(v) + 1; 
		});
		let source = $("#tableTemplate").html();
		let template = Handlebars.compile(source);
		let numberFormat = new Intl.NumberFormat(undefined, { style: "percent", minimumFractionDigits: 2}).format;
		$.getJSON("http://basilicum.bytekeeper.org/stats/game_results.json", function(data) {
			for (i = 0; i < data.length; i++) {
				let botA = data[i].botA;
				let botB = data[i].botB;
				data[i].botAWon = botA === data[i].winner;
				data[i].botBWon = botB === data[i].winner;
				data[i].time = new Date(data[i].endedAt * 1000).toLocaleString();
				data[i].replayUrl = "http://basilicum.bytekeeper.org/bots/" + botA + "/"+  botA + " vs " + botB + " " + data[i].map + " " + data[i].gameHash + ".rep"
			}
			// Required for index to work as expected
			data.sort(function(a,b) { 
				return b.endedAt - a.endedAt;
			});
			let html = template(data);
			$("#gamesTable tbody").append(html);
			$("#gamesTable").tablesorter();
		});
	});
	
	var basil = {};
	(function() {
		this.filter = {}
		this.doFilter = function() {
			let filter = this.filter;
			$("#gamesTable tr").show();
			$("#gamesTable tbody tr").each(function() {
				let cols = $(this).children("td");
				if (filter.botName && !cols.eq(0).text().toLowerCase().includes(filter.botName)
					&& !cols.eq(1).text().toLowerCase().includes(filter.botName)) $(this).hide();
				if (filter.mapName && !cols.eq(2).text().toLowerCase().includes(filter.mapName)) $(this).hide();
			});
		};
		let timer = 0;
		function scheduleFiltering() {
			if (timer) clearTimeout(timer);
			timer = setTimeout(basil.doFilter.bind(basil), 400);
		}

		this.filterByBot = function(value) {
			this.filter.botName = value.toLowerCase();
			scheduleFiltering();
		}
		this.filterByMap = function(value) {
			this.filter.mapName = value.toLowerCase();
			scheduleFiltering();
		}

	}).apply(basil);
</script>
<form action="javascript:void(0);">
	<h3>Filters:</h3>
	<label for="botName">Bot</label>
	<input type="text" id="botName" oninput="basil.filterByBot(this.value)">
	<label for="mapName">Map</label>
	<input type="text" id="mapName" oninput="basil.filterByMap(this.value)">
</form>
<table id="gamesTable">
	<thead>
		<tr>
			<th>Bot A</th>
			<th>Bot B</th>
		<th>Map</th>
		<th>Ended At</th>
		<th data-sorter="false"><i class="fas fa-download"></i></th>
		<th data-sorter="false"><i class="fas fa-eye"></i></th>
	</tr>
	</thead>
	<tbody>
	</tbody>
</table>
<small>Source: <a href="http://basilicum.bytekeeper.org/stats/game_results.json">http://basilicum.bytekeeper.org/stats/game_results.json</a></small>
</table>

